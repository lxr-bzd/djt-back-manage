<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="Keywords" content="" />
		<meta name="Description" content="" />
		<link rel="stylesheet" href="css/web.css" />
		<style>
			.gobuttom{
				position: fixed;
			    display: inline-block;
			    padding: 6px 10px;
			    background-color: blue;
			    color: #fff;
			    border-radius: 7px;
			    top: 10px;
			    right: 10px;
			}
			.gotop{
				position: fixed;
			    display: inline-block;
			    padding: 6px 10px;
			    background-color: blue;
			    color: #fff;
			    border-radius: 7px;
			    bottom: 10px;
			    right: 10px;
			}
		</style>
	</head>
	<body>
	<a class="gobuttom" href="#cbottom">回到底部</a>
	<a class="gotop" href="#ctop">回到頂部</a>
		<div class="h-center">
			<table>
				<tr>
					<td colspan="5" id="ctop">計算表</td>
				</tr>
				<tr>
					<td class="fh"><a href="javascript:top.window.$('.user_admin').click();">返回</a></td>
					<td class="empty"></td>
					<td><select id="model_select" onchange="renderTb(model)">
					<option value="1">計算表  A</option>
					<option value="2">計算表  B</option>
					<option value="3">計算表  C</option></select>
					</td>
					<td class="empty"></td>
					<td class="last">
						<select id="history_group" onchange="selectHistory()">
							<option>--</option>
						</select>
					</td>
				</tr>
				<tr>
					<td class="txl" colspan="4" id="detail_group">
						ID :--   用護名 :--   正在使用的工作表 : 第<span id="tbNum">--</span>張
					</td>
					<td>
						時間日期
					</td>
				</tr>
			</table>
		
			<table class="h-two">
				<tr>
					<td colspan="2">序號</td>
					<td>小结</td>
					<td colspan="2">第1戶</td>
					<td>小结</td>
					<td>小结</td>
					<td colspan="2">第2戶</td>
					<td>小结</td>
					<td>小结</td>
					<td colspan="2">第3戶</td>
					<td>小结</td>
					<td>小结</td>
					<td colspan="2">第4戶</td>
					<td>小结</td>
					<td>小结</td>
					<td colspan="2">第5戶</td>
					<td>小结</td>
					<td>小结</td>
					<td colspan="2">第6戶</td>
					<td>小结</td>
					<td>小结</td>
					<td colspan="2">第7戶</td>
					<td>小结</td>
					<td>小结</td>
					<td colspan="2">第8戶</td>
					<td>小结</td>
					<td>小结</td>
					<td colspan="2">第9戶</td>
					<td>小结</td>
					<td>小结</td>
					<td colspan="2">第10戶</td>
					<td>小结</td>
					<td>序号</td>
				</tr>
				<tbody id="main_group">
				<!--六个-->
				<tr>
					<td rowspan="4">001</td>
					<td>生</td>
					<td rowspan="24"></td>
					<td colspan="2">4</td>
					<td rowspan="24"></td>
					<td rowspan="24"></td>
					<td colspan="2">4</td>
					<td rowspan="24"></td>
					<td rowspan="24"></td>
					<td colspan="2">4</td>
					<td rowspan="24"></td>
					<td rowspan="24"></td>
					<td colspan="2">4</td>
					<td rowspan="24"></td>
					<td rowspan="24"></td>
					<td colspan="2">4</td>
					<td rowspan="24"></td>
					<td rowspan="24"></td>
					<td colspan="2">4</td>
					<td rowspan="24"></td>
					<td rowspan="24"></td>
					<td colspan="2">4</td>
					<td rowspan="24"></td>
					<td rowspan="24"></td>
					<td colspan="2">4</td>
					<td rowspan="24"></td>
					<td rowspan="24"></td>
					<td colspan="2">4</td>
					<td rowspan="24"></td>
					<td rowspan="24"></td>
					<td colspan="2">4</td>
					<td rowspan="24"></td>
					<td rowspan="24"></td>
				</tr>
				<tr>
					<td>配</td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
				</tr>
				<tr>
					<td>兑</td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<td>供</td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<td rowspan="4">002</td>
					<td>生</td>
					<td colspan="2">4</td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
				</tr>
				<tr>
					<td>配</td>
					<td colspan="2">4</td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
				</tr>
				<tr>
					<td>兑</td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<td>供</td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<td rowspan="4">003</td>
					<td>生</td>
					<td colspan="2">4</td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
				</tr>
				<tr>
					<td>配</td>
					<td colspan="2">4</td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
				</tr>
				<tr>
					<td>兑</td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<td>供</td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<td rowspan="4">004</td>
					<td>生</td>
					<td colspan="2">4</td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
				</tr>
				<tr>
					<td>配</td>
					<td colspan="2">4</td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
				</tr>
				<tr>
					<td>兑</td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<td>供</td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<td rowspan="4">005</td>
					<td>生</td>
					<td colspan="2">4</td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
				</tr>
				<tr>
					<td>配</td>
					<td colspan="2">4</td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
				</tr>
				<tr>
					<td>兑</td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<td>供</td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<td rowspan="4">006</td>
					<td>生</td>
					<td colspan="2">4</td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
				</tr>
				<tr>
					<td>配</td>
					<td colspan="2">4</td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
					<td colspan="2"></td>
				</tr>
				<tr>
					<td>兑</td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<td>供</td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
				</tbody>
				<!--六个-->
				
				<!--底部-->
				<tbody id="xjtg_group" class="exTable">
				<tr>
					<td colspan="2">小结统计</td>
					<td class="rd">-</td>
					<td colspan="2"></td>
					<td class="rd">-</td>
					<td class="rd">-</td>
					<td colspan="2"></td>
					<td class="rd">-</td>
					<td class="rd">-</td>
					<td colspan="2"></td>
					<td class="rd">-</td>
					<td class="rd">-</td>
					<td colspan="2"></td>
					<td class="rd">-</td>
					<td class="rd">-</td>
					<td colspan="2"></td>
					<td class="rd">-</td>
					<td class="rd">-</td>
					<td colspan="2"></td>
					<td class="rd">-</td>
					<td class="rd">-</td>
					<td colspan="2"></td>
					<td class="rd">-</td>
					<td class="rd">-</td>
					<td colspan="2"></td>
					<td class="rd">-</td>
					<td class="rd">-</td>
					<td colspan="2"></td>
					<td class="rd">-</td>
					<td class="rd">-</td>
					<td colspan="2"></td>
					<td class="rd">-</td>
					<td rowspan="8">結算</td>
				</tr>
				<tr>
					<td colspan="2">小結結果</td>
					<td class="rd" colspan="40">--</td>
				</tr>
				<tr>
					<td colspan="2">提供統計</td>
					<td class="rd" colspan="40">--</td>
				</tr>
				<tr>
					<td colspan="2">提供結果</td>
					<td class="rd" colspan="40">--</td>
				</tr>
				</tbody>
				
				<tr>
					<td class="bgl" colspan="43"></td>
				</tr>
				<tbody class="exTable">
				<tr>
					<td colspan="2">列隊統計</td>
					<td class="rd" colspan="41" id="queue_group">--</td>
				</tr>
				
				<tr> 
					<td colspan="2" rowspan="2">列隊結果</td>
					<td colspan="2">6</td>
					<td colspan="2">7</td>
					<td colspan="2">8</td>
					<td colspan="2">9</td>
					<td colspan="2">10</td>
					<td colspan="2">11</td>
					<td colspan="2">12</td>
					<td colspan="2">13</td>
					<td colspan="2">14</td>
					<td colspan="2">15</td>
					<td colspan="2">16</td>
					<td colspan="2">17</td>
					<td colspan="2">18</td>
					<td colspan="2">19</td>
					<td colspan="2">20</td>
					<td colspan="2">21</td>
					<td colspan="2">22</td>
					<td colspan="2">23</td>
					<td colspan="">24</td>
					<td colspan="">25</td>
					<td colspan="">26</td>
					<td colspan="">27</td>
					<td colspan="">28</td>
				</tr>
				<tr class="rd" id="query_group">
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="2">-</td>
					<td colspan="">-</td>
					<td colspan="">-</td>
					<td colspan="">-</td>
					<td colspan="">-</td>
					<td colspan="">-</td>
				</tr>
				</tbody>
			</table>
		</div>
		<div id="cbottom"></div>
	</body>
	<script type="text/javascript" src="js/jquery-1.12.4.min.js" ></script>
	<script type="text/javascript" src="js/template-web.js"></script>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript" src="layui/layui.all.js"></script>
	
	<script type="text/javascript" src="js/tableExport.min.js"></script>
	<script type="text/javascript" src="js/jquery.base64.js"></script>
	<script type="text/javascript">
	
	$(function(){
		$app.request("history.do",function(json){
			var user = json.map.data.user;
			var history = json.map.data.history||[];
			var html = "";
			var hdata = {};
			var runGame;
			for (var i = 0; i < history.length; i++) {
				var st = "已完成";
				if(history[i].state==1)st="進行中"; 
				html+='<option value='+history[i].id+'>開始於：'+new Date(history[i].createtime).format("yyyy-MM-dd")+'('+st+')</option>';
				if(history[i].state==1)runGame = history[i];
				hdata[history[i].id] = history[i];
			}
			
			$("#history_group").html(html);
			$("#history_group").data("hdata",hdata);
			
			$("#detail_group").html("ID :"+user.djt_u_id+"   用戶名 :"+user.djt_u_name+"  正在使用的工作表 : 第<span id='tbNum'>--</span>張")
			
			if(!runGame)alert("沒有正在工作的表格");
			else selectHistory();
			
		},{param:{uid:$app.getQueryStr("uid")}})
		
		
	})
	

	
	
	function selectHistory(){
		var index = layer.load(1, {
			  shade: [0.5,'#555'] //0.1透明度的白色背景
			});
		
		var hid = $("#history_group").val();
		var h = $("#history_group").data("hdata")[hid];
		if(!h){
			alert("錯誤");
			return;
		}
		$("#tbNum").html(h.tbNum);
		
		$app.request("workData.do",function(json){
			layer.close(index);
			renderTb(json.map)
			
		},{param:{hid:hid}})
		
		
	}
	
	var model = null;
	
	function renderTb(map){
		
		model = map;
		var list = map.data;
		
		
		var vData = {hlist:[list[0],list[1]],mData:[]
		,count:map.count
		,subChar:function(str,i){
			return str.substring(i,i+1);
		}
		,shengpei:function(str){
			if(!str)return '<td colspan="2"></td><td colspan="2"></td><td colspan="2"></td><td colspan="2"></td>'
			+'<td colspan="2"></td><td colspan="2"></td><td colspan="2"></td><td colspan="2"></td>'
			+'<td colspan="2"></td><td colspan="2"></td>';
			var html = "";
			for (var i = 0; i < str.length; i++) {
				html+= '<td colspan="2">'+str.substring(i,i+1)+'</td>';
			}
			
			return html;
		}
		,xiaojie:function(cot,i){
			if(cot.length<i*2+2)return "";
			return cot.substring(i*2,i*2+2);
			
		}
		,duicuo:function(str,i){
			if(!str)return '<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>'
			+'<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>'
			+'<td></td><td></td><td></td><td></td>';
			var html = "";
			for (var i = 0; i < str.length; i++) {
				var s = str.substring(i,i+1);
				html+= '<td >'+(s=="2"?"X":"√")+'</td>';
			}
			
			return html;
		},
		nannv:function(gong,gong_col){
			if(!gong)return '<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>'
			+'<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>'
			+'<td></td><td></td><td></td><td></td>';
			var html = "";
			for (var i = 0; i < gong.length; i++) {
				var gc = "";
				if(gong_col){
					var gc = gong_col.substring(i,i+1);
					if(gc=="2")gc='class="bg"';
				}
				var g = gong.substring(i,i+1);
				html+= '<td '+gc+'>'+g+'</td>';
			}
			
			return html;
		}};
		
		for (var i = 0; i < 180/6; i++) {
			
			vData.mData.push(list.slice(i*6+2,i*6+8));
		}
		var html = template("tmpl_main",vData);
		$("#main_group").html(html);
		
		
		$("#xjtg_group").html(template("tmpl_xjtg",gameCore.xjtg($("#model_select").val(),map.count,"11111111111111111111")));
		
		var queue = gameCore.queue(list);
		var queueSum = 0;
		$("#query_group>td:not(.bd)").each(function(i,e){
			queueSum+=queue.queue[i+6];
			$(e).html(queue.queue[i+6]);
		})
		 $("#queue_group").html(queueSum);
		
	}
	
	
	
	function tableExport(){
		var tb = $("<table></table>").append($(".exTable").clone());
		$("body").append(tb);
		tb.tableExport({type:'excel',ignoreColumn: [],ignoreRow:[]
			, separator:';', escape:'false'
				 ,formats: ['xlsx']
		,fileName: '後臺表導出'+new Date().format("yyyy-MM-dd")});
		tb.remove();
	}

	
	
	
	</script>
	<script type="text/javascript">

	var gameCore = {
			xjtg:function(mod,count,lastGong){
				var xj = {};//小结
				var xjCount = 0;//小结统计
				var tg = 0;//提供数
				var tgSum =0;//提供值
				for (var i = 0; i < count.length; i++) {
					var hu = {l:0,r:0};
					
					var ltg,rtg;
					switch ((mod+'')) {
					case '2':
						ltg = count[i].bl_tg;
						rtg = count[i].br_tg;
						break;
					case '3':
						ltg = count[i].cl_tg;
						rtg = count[i].cr_tg;
						break;
					case '1':
					default:
						ltg = count[i].al_tg;
						rtg = count[i].ar_tg;
					
						break;
					}
					
					if(rtg)
					for (var j = 0; j < rtg.length/4; j++){
						//小结统计
						var l = new Number(ltg.substring(j*4+2,j*4+4));
						var r = new Number(rtg.substring(j*4+2,j*4+4));
						hu.l+=l;
						hu.r+=r;
						
						
						if(ltg.substring(j*4,j*4+2)=="01"){
							tg+=1;
							tgSum+=l;
						}
						if(rtg.substring(j*4,j*4+2)=="01"){
							tg+=1;
							tgSum+=r;
							
						}
					}
					
					
				
					xjCount+=hu.l;
					xjCount+=hu.r;
					xj[count[i].index] = hu;
					
				}
				var tgInfo = this.tgInfo(mod,count,lastGong,tg);
				
				
				return {xj:xj,xjCount:xjCount,tg:tg+tgInfo.tg,tgSum:tgSum,tgInfo:tgInfo.list};
			}
	
		,tgInfo:function(mod,count,lastGong){
			var tg = 0;
			var tgInfo = {};
			for (var i = 0; i < count.length; i++) {
				tgInfo[count[i].index] = {};
				var lp1,lp2,lp3,lp4,rp1,rp2,rp3,rp4;
				var lc = count[i].lcount;
				var rc = count[i].rcount;
				if(lc.length>=4){
					lp1 = new Number(lc.substring(lc.length-2,lc.length));
					lp2 = new Number(lc.substring(lc.length-4,lc.length-2));
					
					rp1 = new Number(rc.substring(rc.length-2,rc.length));
					rp2 = new Number(rc.substring(rc.length-4,rc.length-2));
				}
				if(lc.length>=6){
					var lp3 = new Number(lc.substring(lc.length-6,lc.length-4));
					var rp3 = new Number(rc.substring(rc.length-6,rc.length-4));
				}
				
				if(lc.length>=8){
					var lp4 = new Number(lc.substring(lc.length-8,lc.length-6));
					var rp4 = new Number(rc.substring(rc.length-8,rc.length-6));
				}
				
				
				
				switch ((mod+'')) {
				case '2':
					if(lp1!==undefined&&lp2!==undefined&&lp3!==undefined)
						if(lp1*lp2>0&&lp1*lp3>0){
						tg+=1;
						tgInfo[count[i].index].l = lastGong.substring(i*2,i*2+1);
						
					}
						
					if(rp1!==undefined&&rp2!==undefined&&rp3!==undefined)
						if(rp1*rp2>0&&rp1*rp3>0){
						tg+=1;
						tgInfo[count[i].index].r = lastGong.substring(i*2+1,i*2+2);	
					}
						
					
					break;
				case '3':
					if(lp1!==undefined&&lp2!==undefined&&lp3!==undefined&&lp4!==undefined)
						if(lp1*lp2>0&&lp1*lp3>0&&lp1*lp4>0){
							tg+=1;
							tgInfo[count[i].index].l = lastGong.substring(i*2,i*2+1);
						}
					if(rp1!==undefined&&rp2!==undefined&&rp3!==undefined&&rp4!==undefined)
						if(rp1*rp2>0&&rp1*rp3>0&&rp1*rp4>0){
							tg+=1;
							tgInfo[count[i].index].r = lastGong.substring(i*2+1,i*2+2);
						}	
					
					break;
				case '1':
				default:
					if(lp1!==undefined&&lp2!==undefined)
						if(lp1*lp2>0){
							tg+=1;
							tgInfo[count[i].index].l = lastGong.substring(i*2,i*2+1);
						}
					if(rp1!==undefined&&rp2!==undefined)
						if(rp1*rp2>0){
							tg+=1;
							tgInfo[count[i].index].r = lastGong.substring(i*2+1,i*2+2);
						}	
					
				
					break;
				}
				
				}
			return {tg:tg,list:tgInfo};
			
		}
	
	
		,queue:function(mainTb,onScan){
			var queue = {
					"6":0,"7":0,"8":0,"9":0,"10":0,"11":0
					,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,
					"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,
					"26":0,"27":0,"28":0
			};
			var scan = [];
			var queueCount = 0;
			
			if(mainTb&&mainTb.length>2)
				for (var i = 2; i < mainTb.length; i++) {
					var gong = mainTb[i].gong;
					var gongCol = mainTb[i].gong_col;
					if(onScan)onScan(i,gong,gongCol);
					
					if(!gongCol)continue;
					for (var j = 0; j < 20; j++) {
						
							var col = gongCol.substring(j,j+1);
							var val = gong.substring(j,j+1);
							
							
							//处理队列逻辑
							if(scan[j]&&scan[j].hit==col)scan[j].hitNum += 1;
							else scan[j] = {hit:col,hitNum:1};
							scan[j].val = val;
							//统计数量
							if(scan[j].hitNum>5){queue[scan[j].hitNum]+=1;queueCount++;}
					
					}
			}
			
			return {queue:queue,scan:scan,count:queueCount};
			
		}
	
			
			
	}
	
	</script>
	
	<script type="text/html" id="tmpl_xjtg">
	<tr>
	<td colspan="2">小結統計</td>
	<td class="rd">{{xj['1'].l}}</td>
	<td colspan="2"></td>
	<td class="rd">{{xj['1'].r}}</td>
	<td class="rd">{{xj['2'].l}}</td>
	<td colspan="2"></td>
	<td class="rd">{{xj['2'].r}}</td>
	<td class="rd">{{xj['3'].l}}</td>
	<td colspan="2"></td>
	<td class="rd">{{xj['3'].r}}</td>
	<td class="rd">{{xj['4'].l}}</td>
	<td colspan="2"></td>
	<td class="rd">{{xj['4'].r}}</td>
	<td class="rd">{{xj['5'].l}}</td>
	<td colspan="2"></td>
	<td class="rd">{{xj['5'].r}}</td>
	<td class="rd">{{xj['6'].l}}</td>
	<td colspan="2"></td>
	<td class="rd">{{xj['6'].r}}</td>
	<td class="rd">{{xj['7'].l}}</td>
	<td colspan="2"></td>
	<td class="rd">{{xj['7'].r}}</td>
	<td class="rd">{{xj['8'].l}}</td>
	<td colspan="2"></td>
	<td class="rd">{{xj['8'].r}}</td>
	<td class="rd">{{xj['9'].l}}</td>
	<td colspan="2"></td>
	<td class="rd">{{xj['9'].r}}</td>
	<td class="rd">{{xj['10'].l}}</td>
	<td colspan="2"></td>
	<td class="rd">{{xj['10'].r}}</td>
	<td rowspan="4"><a title="导出表格" href="javascript:tableExport()">結算</a></td>
</tr>
<tr>
	<td colspan="2">小結結果</td>
	<td class="rd" colspan="40">{{xjCount}}</td>
</tr>
<tr>
	<td colspan="2">提供統計</td>
	<td class="rd" colspan="40">{{tg}}</td>
</tr>
<tr>
	<td colspan="2">提供結果</td>
	<td class="rd" colspan="40">{{tgSum}}</td>
</tr>
	
	</script>
	
	<script type="text/html" id="tmpl_main">

				<tr>
					<td rowspan="4">0</td>
					<td>生</td>
					<td rowspan="8"></td>
					<td colspan="2">{{subChar(hlist[0].sheng,0)}}</td>
					<td rowspan="8"></td>                     
					<td rowspan="8"></td>                     
					<td colspan="2">{{subChar(hlist[0].sheng,1)}}</td>
					<td rowspan="8"></td>                     
					<td rowspan="8"></td>                     
					<td colspan="2">{{subChar(hlist[0].sheng,2)}}</td>
					<td rowspan="8"></td>                     
					<td rowspan="8"></td>                     
					<td colspan="2">{{subChar(hlist[0].sheng,3)}}</td>
					<td rowspan="8"></td>                     
					<td rowspan="8"></td>                     
					<td colspan="2">{{subChar(hlist[0].sheng,4)}}</td>
					<td rowspan="8"></td>                     
					<td rowspan="8"></td>                     
					<td colspan="2">{{subChar(hlist[0].sheng,5)}}</td>
					<td rowspan="8"></td>                     
					<td rowspan="8"></td>                     
					<td colspan="2">{{subChar(hlist[0].sheng,6)}}</td>
					<td rowspan="8"></td>                     
					<td rowspan="8"></td>                     
					<td colspan="2">{{subChar(hlist[0].sheng,7)}}</td>
					<td rowspan="8"></td>                     
					<td rowspan="8"></td>                     
					<td colspan="2">{{subChar(hlist[0].sheng,8)}}</td>
					<td rowspan="8"></td>                     
					<td rowspan="8"></td>                     
					<td colspan="2">{{subChar(hlist[0].sheng,9)}}</td>
					<td rowspan="8"></td>
					<td rowspan="4">0</td>
				</tr>
				<tr>
					<td>配</td>
					{{#shengpei(hlist[0].pei)}}
				</tr>
				<tr>
					<td>兑</td>
					{{#duicuo(hlist[0].dui)}}
				</tr>
				<tr>
					<td>供</td>
					{{#nannv(hlist[0].gong,hlist[1].gong_col)}} 
				</tr>


				<tr>
					<td rowspan="4">0</td>
					<td>生</td>
					{{#shengpei(hlist[1].sheng)}}
					<td rowspan="4">0</td>
				</tr>
				<tr>
					<td>配</td>
					{{#shengpei(hlist[1].pei)}}
				</tr>
				<tr>
					<td>兑</td>
					{{#duicuo(hlist[1].dui)}}
				</tr>
				<tr>
					<td>供</td>
					{{#nannv(hlist[1].gong,hlist[1].gong_col)}} 
				</tr>
	
 {{each mData as val i}}
<!--六个-->
{{each mData[i] as val2 i2}}
{{if i2==0}}
				<tr>
					<td rowspan="4">{{val2.row}}</td>
					<td>生</td>
					<td rowspan="24">{{xiaojie(count[0].lcount,i)}}</td><td colspan="2">{{subChar(val2.sheng,0)}}</td><td rowspan="24">{{xiaojie(count[0].rcount,i)}}</td>
					<td rowspan="24">{{xiaojie(count[1].lcount,i)}}</td><td colspan="2">{{subChar(val2.sheng,1)}}</td><td rowspan="24">{{xiaojie(count[1].rcount,i)}}</td>
					<td rowspan="24">{{xiaojie(count[2].lcount,i)}}</td><td colspan="2">{{subChar(val2.sheng,2)}}</td><td rowspan="24">{{xiaojie(count[2].rcount,i)}}</td>
					<td rowspan="24">{{xiaojie(count[3].lcount,i)}}</td><td colspan="2">{{subChar(val2.sheng,3)}}</td><td rowspan="24">{{xiaojie(count[3].rcount,i)}}</td>
					<td rowspan="24">{{xiaojie(count[4].lcount,i)}}</td><td colspan="2">{{subChar(val2.sheng,4)}}</td><td rowspan="24">{{xiaojie(count[4].rcount,i)}}</td>
					<td rowspan="24">{{xiaojie(count[5].lcount,i)}}</td><td colspan="2">{{subChar(val2.sheng,5)}}</td><td rowspan="24">{{xiaojie(count[5].rcount,i)}}</td>
					<td rowspan="24">{{xiaojie(count[6].lcount,i)}}</td><td colspan="2">{{subChar(val2.sheng,6)}}</td><td rowspan="24">{{xiaojie(count[6].rcount,i)}}</td>
					<td rowspan="24">{{xiaojie(count[7].lcount,i)}}</td><td colspan="2">{{subChar(val2.sheng,7)}}</td><td rowspan="24">{{xiaojie(count[7].rcount,i)}}</td>
					<td rowspan="24">{{xiaojie(count[8].lcount,i)}}</td><td colspan="2">{{subChar(val2.sheng,8)}}</td><td rowspan="24">{{xiaojie(count[8].rcount,i)}}</td>
					<td rowspan="24">{{xiaojie(count[9].lcount,i)}}</td><td colspan="2">{{subChar(val2.sheng,9)}}</td><td rowspan="24">{{xiaojie(count[9].rcount,i)}}</td>
					<td rowspan="24"></td>
				</tr>
{{else}}

				<tr>
					<td rowspan="4">{{val2.row}}</td>
					<td>生</td>
					{{#shengpei(val2.sheng)}}
				</tr>
{{/if}}
				

				<tr><td>配</td>
					{{#shengpei(val2.pei)}}
				</tr>

				<tr>
					<td>兑</td>
					{{#duicuo(val2.dui)}}
				</tr>


				<tr>
					<td>供</td>
					{{#nannv(val2.gong,val2.gong_col)}} 
				</tr>
{{/each}}
<!--六个结束-->
				
{{/each}}
	</script>
	
	
	
</html>
